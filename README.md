# paper_spatiotemporal-marine-eDNA-metabarcoding
The code and data provided here will allow anyone to reproduce the analyses and results described in
> Scriver, M., von Ammon, U., Pochon, X., Zirngibl, M., Audrezet, F., Leonard, K., Pedersen, K., Bamford, N., Tahere, N., Stanton, J. L., Gemmell, N. J., & Zaiko, A. (2024) Ebbs and Flows of Marine Biodiversity: Navigating Spatio-Temporal Patterns of Environmental DNA in a Coastal Tidal Ecosystem. [Manuscript submitted for publication].

# Paper abstract
Environmental DNA (eDNA) offers an efficient approach for biodiversity monitoring and biosecurity surveillance in coastal ecosystems. Understanding eDNA dynamics in tidal areas is critical for guiding sampling strategy design and interpreting molecular detection results. In a field study conducted at Ōpua, Bay of Islands, Aotearoa, New Zealand, an international marina with a dynamic coastal environment, we investigated eDNA detection patterns across a local spatial and temporal gradient. Hourly samples were collected from six sampling stations around the marina, from artificial shore structures and a channel, over a 12-hour tidal cycle. Detected eukaryotic communities were assessed using eDNA metabarcoding analysis of the small-subunit ribosomal RNA (18S rRNA) and mitochondrial Cytochrome C Oxidase subunit I (COI) genes. This core community was screened for marine non-indigenous species (NIS) using an online metabarcoding data screening app (ExPAT). Community composition varied significantly based on sampling location and time, with most of the core community captured around mid-tide. The NIS community exhibited inconsistent detection for some species (e.g. the amphipod Monocorophium acherusicum) across space and time, while other NIS (e.g. the mussel Arcuatula senhousia) were consistently detected and behaved similarly to the core community. Overall, species-specific eDNA detection patterns may be linked to the biology and movement of the organism. The results indicated slightly higher NIS detection from artificial structures at the shore stations and within 2 hours of low tide. For marine biosecurity applications, users may want to prioritize sampling near-shore during low tide, while samples collected during mid-tide may provide more comprehensive insights into the core community for biomonitoring. Further field studies across multiple tidal cycles and marinas may guide the standardization of molecular biomonitoring and biosurveillance sampling strategies and support their broader integration into marine biosecurity programs.

## [Bioinformatics Analyses](https://github.com/Michellescr/paper_spatiotemporal-marine-eDNA-metabarcoding/tree/main/analyses)

In this study, we focused on unique eDNA sequences, or Amplicon Sequence Variants (ASVs). The denoising approach of ASVs offers high resolution without imposing arbitrary thresholds used in clustering molecular operational taxonomic units (OTUs), making it a promising alternative, especially in environmental sequencing (Callahan et al. 2017; Forster et al. 2019). ASVs, as consistent biological entities, represent true biological sequences, providing high reproducibility, reusability, and data comparability (Callahan et al. 2017; Forster et al. 2019). ASVs are widely used in eDNA studies (Forster et al. 2019; Giebner et al. 2020; Jensen et al. 2022; Pearman et al. 2021; von Ammon et al. 2023a, 2023b), with evidence suggesting that ASV generation more accurately reflects biological patterns (De Santiago et al. 2021). By focusing on ASVs, the aim was to more accurately capture molecular patterns, enhancing the ability to detect subtle shifts in community composition and the presence of marine NIS.

Bioinformatic pipelines for assigning ASVs for both 18S rRNA and COI sequence data were identical unless otherwise stated. The pipeline was conducted as described by von Ammon et al. (2023a) and is outlined below. Cutadapt (Martin, 2011) removed the primer sequences from the raw reads, allowing a single mismatch. Sequences were then processed using the ‘DADA2’ package (Callahan et al., 2016) within R (R Core Team, 2023).

Reads were truncated to 225 and 216 bp for 18S rRNA and COI forward and reverse reads, respectively and filtered with a default maximum number of “expected errors” (maxEE) of 2. Reads not meeting this threshold were discarded. A parametric error matrix was constructed, and sequence variants for the forward and reverse reads were dereplicated. Singletons were removed, and paired-end reads were merged with a minimum overlap of 10 bp and no mismatches. Chimeric sequences were filtered out using the consensus option in the removeBimeraDenovo function.

For the taxonomic classification of 18S rRNA gene amplicons, amplicon sequence variants (ASVs) were matched against the SILVA database (Quast et al., 2013). The DADA2 assignTaxonomy script, utilizing the rdp classifier (Wang et al., 2007), was executed with a bootstrap cutoff of 0.9. If not classified, the process was repeated at a cutoff of 0.5 for assigning higher taxonomic ranks (family and above). Taxonomic assignments of the 18S rRNA were normalized using NCBI curated classification and non-curated databases, employing the "taxa_normalization" function from the R Package "biohelper" (github: https://github.com/olar785/biohelper). This function normalizes the taxonomic naming conventions of eukaryotic data identified via the SILVA database, aligning them with the NCBI-curated classification and nomenclature to ensure consistent naming and accurate taxa column labels. Additionally, it can provide supplementary taxonomic information for specified ranks.

For the COI gene dataset, taxonomic assignment was performed as described in Laroche et al. (2020) using the R Package “biohelper” (github: https://github.com/olar785/biohelper).  This method aims to reduce the number of unassigned sequences and increase taxonomic resolution using megablast from Blastn application (options: -evalue 0.001 -max_target_seqs 5 -task megablast -perc_identity 0.8) (Camacho et al., 2009); and Blastn (options: -evalue 0.001 -max_taget_seqs 5 -task blastn) on the entire GenBank nucleotide (nt) database. For the Blastn methods, taxonomy returned from each hit (max 5 per query sequence) was assigned to the lowest common ancestor (Laroche et al. 2020; von Ammon et al. 2023b). To avoid over classification, this assignment was corrected using the default minimum percent identity value (97%) (Fernandez et al. 2018; Manandhar et al. 2023; von Ammon et al. 2023b) and minimum percentage cover (80%) for each taxonomic rank. Results from the megablast and the Blastn approaches were combined, and taxonomy with the highest resolution was retained. In the case of disagreements, the lowest common ancestor among the different approaches was assigned. The results were combined into a phyloseq object (McMurdie & Holmes, 2013).

We established the maximum sequence count across controls (field blank, extraction blank, PCR blank, or sequencing blank) as the threshold for potentially contaminating ASVs (Bell et al., 2019). ASVs detected in the environmental samples and controls with fewer reads than the threshold were excluded from the analysis. For the environmental samples, each ASVs exceeding the threshold had the threshold value subtracted from the sequence count to mitigate contamination effects.

# [Assessing Detection of Marine Non-Indigenous Species] (https://github.com/Michellescr/paper_spatiotemporal-marine-eDNA-metabarcoding/blob/main/analyses/Subset_Marine_NIS_From_Metabarcoding_data.R)
Using the extended Pest Alert Tool (ExPAT) developed by the Marine Biosecurity Toolbox Programme at the Cawthron Institute (accessible at https://pestalert.builtbyupshift.dev/), as described in the tool's user guide (Zaiko et al., 2023), the fasta files from the metabarcoding data were screened for eDNA signal from Aotearoa, New Zealand marine NIS. The un-rarefied and unfiltered fasta files were merged from all replicates per sampling time/location and uploaded to the Pest Alert Tool, for 18S rRNA or COI genes, respectively (minimum % sequence identity match = 99%, the minimum sequence length (bp) = 300 bp). As recommended, matches to putative pests were verified by cross-referencing with reference sequences and conducting checks through the generation of phylogenetic trees using BLAST pairwise alignment in the NCBI database. Any species that did not demonstrate an unambiguous match in the phylogenetic tree were assigned to genus level. The list of verified putative pests obtained from the tool was then used to filter the 18S rRNA and COI gene datasets. For these filtered NIS gene datasets, rare species removal, as described above, was not performed to ensure that rare species ASVs were not removed, as their detection was the primary aim of this analysis. Possible contamination was addressed using the maximum sequence count for each ASVs threshold, as described above, as this method mitigates potential contamination without limiting the detection of rare NIS (Pearman et al., 2021). To normalize for sequence depth, we chose to use relative abundance to transform the NIS eDNA metabarcoding data, rather than rarefying, to ensure no loss of reads, as detection was the main goal (Laporte et al., 2021). 
